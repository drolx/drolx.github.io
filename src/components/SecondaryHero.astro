---
import { getRouteObjects } from '@/utils/routes';

interface Props {
  title: string;
  description: string;
}

const { title, description } = Astro.props;
const pathname = Astro.url.pathname;
const pathSegments = pathname
  .split("/")
  .filter(Boolean)
  .reduce<string[]>(
    (acc, _, i, arr) => {
      acc.push("/" + arr.slice(0, i + 1).join("/"));
      return acc;
    },
    ["/"],
  );

const pages = await getRouteObjects();
const breadcrumbs = pathSegments.map((path) => {
	const item = pages.find(x => x.url === path);
  return {
    path,
    label: item?.title ?? 'No Label',
  };
});
---

<section
  class="relative bg-primary text-white py-8 px-4 overflow-hidden"
  style="
      background: linear-gradient(
        135deg,
        #03144a 0%,
        #1347bf 80%,
        #2370ff 100%
      );
    "
>
  <div class="max-w-7xl mx-auto relative z-10">
    <!-- Breadcrumb -->
    <div class="text-sm breadcrumbs mb-8">
      <ul>
        {
          breadcrumbs.map((breadItem, index) =>
            index !== breadcrumbs.length - 1 ? (
              <li>
                <a href={breadItem.path}>{breadItem.label ?? "Missing"}</a>
              </li>
            ) : (
              <li>{breadItem.label ?? "Missing"}</li>
            ),
          )
        }
      </ul>
    </div>
    <div class="max-w-2xl">
      <h1 class="text-4xl lg:text-6xl font-bold mb-4">{title}</h1>
      <p class="text-lg lg:text-xl opacity-95 mb-6 line-clamp-2">
        {description}
      </p>
    </div>
    <slot name="inner" />
  </div>
  <slot />
</section>
